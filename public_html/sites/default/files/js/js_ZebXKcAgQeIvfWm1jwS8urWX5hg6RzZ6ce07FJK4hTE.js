Drupal.locale = { 'pluralFormula': function ($n) { return Number(($n!=1)); }, 'strings': {"":{"Edit":"Redig\u00e9r","Default":"Standard","Media browser":"Mediebrowser","Add":"Tilf\u00f8j","Key":"N\u00f8gle","Search":"S\u00f8g","Status":"Status","Value":"V\u00e6rdi","Not published":"Ikke udgivet","Size":"St\u00f8rrelse","All":"Alle","Enabled":"Aktiveret","Disabled":"Deaktiveret","An AJAX HTTP error occurred.":"Der opstod en AJAX HTTP-fejl.","HTTP Result Code: !status":"HTTP resultatkode: !status","An AJAX HTTP request terminated abnormally.":"En AJAX HTTP-foresp\u00f8rgsel afsluttede p\u00e5 unormal vis.","Debugging information follows.":"Information til fejls\u00f8gning f\u00f8lger.","Path: !uri":"Sti: !uri","StatusText: !statusText":"StatusText: !statusText","ResponseText: !responseText":"ResponseText: !responseText","ReadyState: !readyState":"ReadyState: !readyState","CustomMessage: !customMessage":"CustomMessage: !customMessage","Configure":"Konfigur\u00e9r","Cancel":"Annull\u00e9r","Remove":"Fjern","Mon":"man","Monday":"Mandag","Submit":"Indsend","(active tab)":"(aktiv fane)","This field is required.":"Dette felt er obligatorisk.","Next":"N\u00e6ste","none":"ingen","Sunday":"S\u00f8ndag","Tuesday":"Tirsdag","Wednesday":"Onsdag","Thursday":"Torsdag","Friday":"Fredag","Saturday":"L\u00f8rdag","Filename":"Filnavn","Done":"F\u00e6rdig","N\/A":"N\/A","OK":"O.k.","Prev":"Forrige","Tue":"tir","Wed":"ons","Thu":"tor","Fri":"fre","Sat":"l\u00f8r","Sun":"s\u00f8n","January":"Januar","February":"Februar","March":"Marts","April":"April","May":"maj","June":"Juni","July":"Juli","August":"August","September":"September","October":"Oktober","November":"November","December":"December","Show":"Vis","Select all rows in this table":"V\u00e6lg alle r\u00e6kker i tabellen","Deselect all rows in this table":"Frav\u00e6lg alle r\u00e6kker i tabellen","Today":"I dag","Jan":"jan","Feb":"feb","Mar":"mar","Apr":"apr","Jun":"jun","Jul":"jul","Aug":"aug","Sep":"sep","Oct":"okt","Nov":"nov","Dec":"dec","Su":"S\u00f8","Mo":"Ma","Tu":"Ti","We":"On","Th":"To","Fr":"Fr","Sa":"L\u00f8","Shortcuts":"Genveje","Please wait...":"Vent venligst\u2026","Hide":"Skjul","mm\/dd\/yy":"mm\/dd\/yy","By @name on @date":"Af @name, @date","By @name":"Af @name","Not in menu":"Ikke i menu","Alias: @alias":"Alias: @alias","No alias":"Intet alias","New revision":"Ny version","Drag to re-order":"Tr\u00e6k for at (om)sortere","Changes made in this table will not be saved until the form is submitted.":"\u00c6ndringer i tabellen bliver ikke gemt, f\u00f8r du indsender formularen.","The changes to these blocks will not be saved until the \u003Cem\u003ESave blocks\u003C\/em\u003E button is clicked.":"\u00c6ndringerne bliver ikke gemt f\u00f8r du trykker p\u00e5 knappen \u003Cem\u003EGem blokke\u003C\/em\u003E.","This permission is inherited from the authenticated user role.":"Denne tilladelse er arvet fra den godkendte brugerrolle.","No revision":"Ingen version","@number comments per page":"@number kommentarer pr. side","Requires a title":"Kr\u00e6ver en titel","Not restricted":"Ikke begr\u00e6nset","Not customizable":"Kan ikke tilpasses","Restricted to certain pages":"Begr\u00e6nset til bestemte sider","The block cannot be placed in this region.":"Blokken kan ikke placeres i denne region.","Hide summary":"Skjul resum\u00e9","Edit summary":"Redig\u00e9r resum\u00e9","Don\u0027t display post information":"Vis ikke information om indl\u00e6gget","The selected file %filename cannot be uploaded. Only files with the following extensions are allowed: %extensions.":"Den valgte fil %filename kan ikke uploades. Kun filer med f\u00f8lgende filendelser er tilladt: %extensions.","Re-order rows by numerical weight instead of dragging.":"Sort\u00e9r r\u00e6kker med numeriske v\u00e6gte i stedet for at tr\u00e6kke dem.","Show row weights":"Vis r\u00e6kkef\u00f8lge","Hide row weights":"Skjul r\u00e6kkef\u00f8lge","Autocomplete popup":"Autocomplete popup","Searching for matches...":"S\u00f8ger efter resultater...","No results":"Ingen resultater","New":"Ny","Loading token browser...":"Indl\u00e6ser token-browser...","Available tokens":"Tilg\u00e6ngelige symboler","Insert this token into your form":"Inds\u00e6t dette token i din formular","First click a text field to insert your tokens into.":"Klik p\u00e5 et tekstfelt som tokens skal s\u00e6ttes ind i.","Breadcrumbs":"Br\u00f8dkrummer","Select all":"Mark\u00e9r alt","Add item":"Tilf\u00f8j menupunkt","List additional actions":"Vis yderligere handlinger","Close":"Luk","Automatic alias":"Automatisk alias","Using defaults":"Bruger standardindstillinger","Scheduled for publishing":"Planlagt til publicering","Scheduled for unpublishing":"Planlagt til afpublicering","Not scheduled":"Ikke planlagt","No redirects":"Ingen omdirigeringer","Also allow !name role to !permission?":"Giv tilladelsen !permission til rollen !name?","all":"alle","Select":"V\u00e6lg","No flags":"Ingen flag","Show layout designer":"Vis layout-designer","Hide layout designer":"Skjul layout-designer","Remove group":"Fjern gruppe","Apply (all displays)":"Anvend (alle displays)","Apply (this display)":"Anvend (dette display)","Revert to default":"Gendan til standard","Cropping Image":"Billedbesk\u00e6ring","Apply crop":"Gem besk\u00e6ring","Changes made in image crops will not be saved until the form is submitted.":"\u00c6ndringer til besk\u00e6ringer gemmes sammen med billedet ved gem.","Cannot continue, nothing selected":"Kan ikke forts\u00e6tte, intet valgt","Start upload":"Start upload","If you switch views, you will lose your selection.":"Hvis du skifter views mister du dine valg.","Add files":"Tilf\u00f8j filer","Drag files here.":"Tr\u00e6k filer hertil","One domain with multiple subdomains":"\u00c9t dom\u00e6ne med flere subdom\u00e6ner","Universal web tracking opt-out":"Universel afmelding af web tracking","A single domain":"Et enkelt dom\u00e6ne","All pages with exceptions":"Alle sider med undtagelser","Excepted: @roles":"Undtaget: @roles","On by default with opt out":"Sl\u00e5et til som standard med opt out.","Off by default with opt in":"Sl\u00e5et fra som standard med opt in.","Downloads":"Downloads","Not tracked":"Ikke sporet","@items enabled":"@items aktiveret","No privacy":"Ingen beskyttelse af personlige oplysninger","The callback URL is not local and not trusted: !url":"Callback-URLen er ikke lokal og er ikke trov\u00e6rdig: !url","Select all children":"V\u00e6lg alle underord","Save to basket":"Gem som v\u00e6rkt\u00f8j","Remove from basket":"Fjern v\u00e6rkt\u00f8j","Add to toolbox":"Tilf\u00f8j til v\u00e6rkt\u00f8jskasse","Success!":"Succes!","The page was sucessfully added to the basket":"Siden blev tilf\u00f8jet til kurven.","An error occured":"Der opstod en fejl!","Try to refresh the page and try again.":"Genopfrisk siden og fors\u00f8g igen."}} };;
(function ($) {
  Drupal.behaviors.node_basket = {
    attach: function (context, settings) {

      if (typeof Drupal.settings.node_basket !== 'undefined') {
        $('#node-basket').html('<div id="node-basket-basket"></div><div id="node-basket-toolbox"></div>');
        if (typeof Drupal.settings.node_basket.nid !== 'undefined') {
          var nid = Drupal.settings.node_basket.nid;
          var markup = '<div id="nodebasket-status">';

          $('.add_to_basket > a').on('click', function (event) {
            event.preventDefault();

            $.get('/node_basket/basket/add/' + nid, function (data) {

              // Success
              if (data.err == false) {
                bs3Alert.push(Drupal.t('Success!'), Drupal.t('The page was sucessfully added to the basket'), 'success');
              }
              // Error
              else {
                bs3Alert.push(Drupal.t('An error occured'), Drupal.t('Try to refresh the page and try again.'), 'danger');
              }
            });
          });

          $.get('/node_basket/basket/status/' + nid, function (data) {
            if (data.err) {
              $('#node-basket-basket').html('<a id="add-to-nodebasket" href="#">' + Drupal.t('Save to basket') + '</a>' + markup);

              $('#node-basket #add-to-nodebasket').on('click', function () {
                $('#node-basket #nodebasket-status').html('<span class="icon-node-basket-wait"></span>');

                $.get('/node_basket/basket/add/' + nid, function (data) {
                  Drupal.behaviors.node_basket.updatestatus('#nodebasket-status', data.err);
                });

                Drupal.behaviors.node_basket.reattach();
              });
            }
            else {
              $('#node-basket-basket').html('<a id="remove-from-nodebasket" href="#">' + Drupal.t('Remove from basket') + '</a>' + markup);
              $('#node-basket #remove-from-nodebasket').click(function () {
                $('#node-basket #nodebasket-status').html('<span class="icon-node-basket-wait"></span>');

                $.get('/node_basket/basket/remove/' + nid, function (data) {
                  Drupal.behaviors.node_basket.updatestatus('#nodebasket-status', data.err);
                });

                Drupal.behaviors.node_basket.reattach();
              });
            }
          });
        }

        if (Drupal.settings.node_basket.addtoolbox) {
          $('#node-basket-toolbox').html('<a id="add-to-nodebasket-toolbox" href="#">' + Drupal.t('Add to toolbox') + '</a><div id="nodebasket-toolbox-status"></div><div id="nodebasket-toolbox-list" style="display: none";></div>');

          $('#node-basket #add-to-nodebasket-toolbox').click(function () {
            var position = $(this).position();

            $('#nodebasket-toolbox-list').css('top', position.top + $(this).height());
            $('#nodebasket-toolbox-list').css('left', position.left);
            $('#nodebasket-toolbox-list').toggle();
          });

          $.get('/node_basket/toolbox_list', function (data) {
            $.each(data, function (key, value) {
              $('#nodebasket-toolbox-list').append('<a class="nodebasket-add-to-toolbox" href="#" data-toolbox-id="' + key + '">' + value + '</a>');
            });

            $('.nodebasket-add-to-toolbox').click(function () {

              $('#nodebasket-toolbox-list').hide();
              $('#nodebasket-toolbox-status').html('<span class="icon-node-basket-wait"></span>');

              if (typeof Drupal.settings.node_basket.nid !== 'undefined') {
                $.get('/node_basket/basket/tb_add/' + $(this).data('toolbox-id') + '/' + nid, function (data) {
                  Drupal.behaviors.node_basket.updatestatus('#nodebasket-toolbox-status', data.err);
                });
              }
              else {
                $.get('/node_basket/basket/link_add/' + $(this).data('toolbox-id') + '/?url=' + encodeURIComponent(window.location.href), function (data) {
                  Drupal.behaviors.node_basket.updatestatus('#nodebasket-toolbox-status', data.err);
                });
              }
              Drupal.behaviors.node_basket.reattach();
            });
          });
        }
      }
      // show basket contents on hover
      var menu_hover = 0;

      $('.toolbox-content').hide();
      $('.view-id-node_basket .views-row').hover(
        function (event) {
          menu_hover++;
          var id = $(this).find('.toolbox-title').data('toolbox-id');

          setTimeout(function () {
            $(".toolbox-content").not(".js-toolbox_id-" + id).fadeOut(100);
          }, 100);

          $(".js-toolbox_id-" + id).fadeIn(400);


        },
        function (event) {
          var id = $(this).find('.toolbox-title').data('toolbox-id');
          menu_hover--;
          setTimeout(function () {
            if (menu_hover === 0) {
              $(".js-toolbox_id-" + id).fadeOut(300);
            }
          }, 400);
        }
      );
    },

    reattach: function () {
      setTimeout(function () {
        Drupal.behaviors.node_basket.attach();
      }, 600);
    },

    updatestatus: function (el, err) {
      if (!err) {
        $('#node-basket ' + el).html('<span class="icon-node-basket-success"></span>');
      }
      else {
        $('#node-basket ' + el).html('<span class="icon-node-basket-error"></span>');
      }
    }
  };
}(jQuery));

(function ($) {

  Drupal.behaviors.node_basket_menu = {
    attach: function (context, settings) {
      node_basket_user_menu();
    }
  };

  /**
   * Fetches user group memberships from ajax callback.
   */
  function node_basket_user_menu() {

    $.getJSON('/node_basket/menu/ajax', function(data) {

      // Test if we got group data back
      if (Object.keys(data).length > 0) {

        var $ul = $('<ul class="main-navigation-list-dropdown-menu sidebar-navigation-dropdown-menu" />');

        // Set class on 'ul's parent
        $ul.parent().addClass('main-navigation-list-dropdown sidebar-navigation-dropdown');

        // Generate list with links and append to parent menu item.
        for (var key in data) {
          var $li = $('<li class="leaf main-navigation-list-link sidebar-navigation-link"><a href="/node/' + data[key].nid + '">' + data[key].title + '</a></li>');
          $ul.append($li);
        }
      }
      var $menu_item = $('a[href="/node_basket"]').parent();
      //$menu_item.find('li').remove();

      if ($ul) {
        $menu_item.append($ul);

        // Set class on 'ul's parent
        $menu_item
            .removeClass('main-navigation-list-link')
            .addClass('main-navigation-list-dropdown');
      }
    });
  }

}(jQuery));
;
(function ($) {

/**
 * Terminology:
 *
 *   "Link" means "Everything which is in flag.tpl.php" --and this may contain
 *   much more than the <A> element. On the other hand, when we speak
 *   specifically of the <A> element, we say "element" or "the <A> element".
 */

/**
 * The main behavior to perform AJAX toggling of links.
 */
Drupal.flagLink = function(context) {
  /**
   * Helper function. Updates a link's HTML with a new one.
   *
   * @param element
   *   The <A> element.
   * @return
   *   The new link.
   */
  function updateLink(element, newHtml) {
    var $newLink = $(newHtml);

    // Initially hide the message so we can fade it in.
    $('.flag-message', $newLink).css('display', 'none');

    // Reattach the behavior to the new <A> element. This element
    // is either whithin the wrapper or it is the outer element itself.
    var $nucleus = $newLink.is('a') ? $newLink : $('a.flag', $newLink);
    $nucleus.addClass('flag-processed').click(flagClick);

    // Find the wrapper of the old link.
    var $wrapper = $(element).parents('.flag-wrapper:first');
    // Replace the old link with the new one.
    $wrapper.after($newLink).remove();
    Drupal.attachBehaviors($newLink.get(0));

    $('.flag-message', $newLink).fadeIn();
    setTimeout(function(){ $('.flag-message.flag-auto-remove', $newLink).fadeOut() }, 3000);
    return $newLink.get(0);
  }

  /**
   * A click handler that is attached to all <A class="flag"> elements.
   */
  function flagClick(event) {
    // Prevent the default browser click handler
    event.preventDefault();

    // 'this' won't point to the element when it's inside the ajax closures,
    // so we reference it using a variable.
    var element = this;

    // While waiting for a server response, the wrapper will have a
    // 'flag-waiting' class. Themers are thus able to style the link
    // differently, e.g., by displaying a throbber.
    var $wrapper = $(element).parents('.flag-wrapper');
    if ($wrapper.is('.flag-waiting')) {
      // Guard against double-clicks.
      return false;
    }
    $wrapper.addClass('flag-waiting');

    // Hide any other active messages.
    $('span.flag-message:visible').fadeOut();

    // Send POST request
    $.ajax({
      type: 'POST',
      url: element.href,
      data: { js: true },
      dataType: 'json',
      success: function (data) {
        data.link = $wrapper.get(0);
        $.event.trigger('flagGlobalBeforeLinkUpdate', [data]);
        if (!data.preventDefault) { // A handler may cancel updating the link.
          data.link = updateLink(element, data.newLink);
        }

        // Find all the link wrappers on the page for this flag, but exclude
        // the triggering element because Flag's own javascript updates it.
        var $wrappers = $('.flag-wrapper.flag-' + data.flagName.flagNameToCSS() + '-' + data.contentId).not(data.link);
        var $newLink = $(data.newLink);

        // Hide message, because we want the message to be shown on the triggering element alone.
        $('.flag-message', $newLink).hide();

        // Finally, update the page.
        $wrappers = $newLink.replaceAll($wrappers);
        Drupal.attachBehaviors($wrappers.parent());

        $.event.trigger('flagGlobalAfterLinkUpdate', [data]);
      },
      error: function (xmlhttp) {
        alert('An HTTP error '+ xmlhttp.status +' occurred.\n'+ element.href);
        $wrapper.removeClass('flag-waiting');
      }
    });
  }

  $('a.flag-link-toggle:not(.flag-processed)', context).addClass('flag-processed').click(flagClick);
};

/**
 * Prevent anonymous flagging unless the user has JavaScript enabled.
 */
Drupal.flagAnonymousLinks = function(context) {
  $('a.flag:not(.flag-anonymous-processed)', context).each(function() {
    this.href += (this.href.match(/\?/) ? '&' : '?') + 'has_js=1';
    $(this).addClass('flag-anonymous-processed');
  });
}

String.prototype.flagNameToCSS = function() {
  return this.replace(/_/g, '-');
}

/**
 * A behavior specifically for anonymous users. Update links to the proper state.
 */
Drupal.flagAnonymousLinkTemplates = function(context) {
  // Swap in current links. Cookies are set by PHP's setcookie() upon flagging.

  var templates = Drupal.settings.flag.templates;

  // Build a list of user-flags.
  var userFlags = Drupal.flagCookie('flags');
  if (userFlags) {
    userFlags = userFlags.split('+');
    for (var n in userFlags) {
      var flagInfo = userFlags[n].match(/(\w+)_(\d+)/);
      var flagName = flagInfo[1];
      var contentId = flagInfo[2];
      // User flags always default to off and the JavaScript toggles them on.
      if (templates[flagName + '_' + contentId]) {
        $('.flag-' + flagName.flagNameToCSS() + '-' + contentId, context).after(templates[flagName + '_' + contentId]).remove();
      }
    }
  }

  // Build a list of global flags.
  var globalFlags = document.cookie.match(/flag_global_(\w+)_(\d+)=([01])/g);
  if (globalFlags) {
    for (var n in globalFlags) {
      var flagInfo = globalFlags[n].match(/flag_global_(\w+)_(\d+)=([01])/);
      var flagName = flagInfo[1];
      var contentId = flagInfo[2];
      var flagState = (flagInfo[3] == '1') ? 'flag' : 'unflag';
      // Global flags are tricky, they may or may not be flagged in the page
      // cache. The template always contains the opposite of the current state.
      // So when checking global flag cookies, we need to make sure that we
      // don't swap out the link when it's already in the correct state.
      if (templates[flagName + '_' + contentId]) {
        $('.flag-' + flagName.flagNameToCSS() + '-' + contentId, context).each(function() {
          if ($(this).find('.' + flagState + '-action').size()) {
            $(this).after(templates[flagName + '_' + contentId]).remove();
          }
        });
      }
    }
  }
}

/**
 * Utility function used to set Flag cookies.
 *
 * Note this is a direct copy of the jQuery cookie library.
 * Written by Klaus Hartl.
 */
Drupal.flagCookie = function(name, value, options) {
  if (typeof value != 'undefined') { // name and value given, set cookie
    options = options || {};
    if (value === null) {
      value = '';
      options = $.extend({}, options); // clone object since it's unexpected behavior if the expired property were changed
      options.expires = -1;
    }
    var expires = '';
    if (options.expires && (typeof options.expires == 'number' || options.expires.toUTCString)) {
      var date;
      if (typeof options.expires == 'number') {
        date = new Date();
        date.setTime(date.getTime() + (options.expires * 24 * 60 * 60 * 1000));
      } else {
        date = options.expires;
      }
      expires = '; expires=' + date.toUTCString(); // use expires attribute, max-age is not supported by IE
    }
    // NOTE Needed to parenthesize options.path and options.domain
    // in the following expressions, otherwise they evaluate to undefined
    // in the packed version for some reason...
    var path = options.path ? '; path=' + (options.path) : '';
    var domain = options.domain ? '; domain=' + (options.domain) : '';
    var secure = options.secure ? '; secure' : '';
    document.cookie = [name, '=', encodeURIComponent(value), expires, path, domain, secure].join('');
  } else { // only name given, get cookie
    var cookieValue = null;
    if (document.cookie && document.cookie != '') {
      var cookies = document.cookie.split(';');
      for (var i = 0; i < cookies.length; i++) {
        var cookie = jQuery.trim(cookies[i]);
        // Does this cookie string begin with the name we want?
        if (cookie.substring(0, name.length + 1) == (name + '=')) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }
};

Drupal.behaviors.flagLink = {};
Drupal.behaviors.flagLink.attach = function(context) {
  // For anonymous users with the page cache enabled, swap out links with their
  // current state for the user.
  if (Drupal.settings.flag && Drupal.settings.flag.templates) {
    Drupal.flagAnonymousLinkTemplates(context);
  }

  // For all anonymous users, require JavaScript for flagging to prevent spiders
  // from flagging things inadvertently.
  if (Drupal.settings.flag && Drupal.settings.flag.anonymous) {
    Drupal.flagAnonymousLinks(context);
  }

  // On load, bind the click behavior for all links on the page.
  Drupal.flagLink(context);
};

})(jQuery);
;
(function ($) {

/**
 * A progressbar object. Initialized with the given id. Must be inserted into
 * the DOM afterwards through progressBar.element.
 *
 * method is the function which will perform the HTTP request to get the
 * progress bar state. Either "GET" or "POST".
 *
 * e.g. pb = new progressBar('myProgressBar');
 *      some_element.appendChild(pb.element);
 */
Drupal.progressBar = function (id, updateCallback, method, errorCallback) {
  var pb = this;
  this.id = id;
  this.method = method || 'GET';
  this.updateCallback = updateCallback;
  this.errorCallback = errorCallback;

  // The WAI-ARIA setting aria-live="polite" will announce changes after users
  // have completed their current activity and not interrupt the screen reader.
  this.element = $('<div class="progress-wrapper" aria-live="polite"></div>');
  this.element.html('<div id ="' + id + '" class="progress progress-striped active">' +
                    '<div class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">' +
                    '<div class="percentage sr-only"></div>' +
                    '</div></div>' +
                    '</div><div class="percentage pull-right"></div>' +
                    '<div class="message">&nbsp;</div>');
};

/**
 * Set the percentage and status message for the progressbar.
 */
Drupal.progressBar.prototype.setProgress = function (percentage, message) {
  if (percentage >= 0 && percentage <= 100) {
    $('div.progress-bar', this.element).css('width', percentage + '%');
    $('div.progress-bar', this.element).attr('aria-valuenow', percentage);
    $('div.percentage', this.element).html(percentage + '%');
  }
  $('div.message', this.element).html(message);
  if (this.updateCallback) {
    this.updateCallback(percentage, message, this);
  }
};

/**
 * Start monitoring progress via Ajax.
 */
Drupal.progressBar.prototype.startMonitoring = function (uri, delay) {
  this.delay = delay;
  this.uri = uri;
  this.sendPing();
};

/**
 * Stop monitoring progress via Ajax.
 */
Drupal.progressBar.prototype.stopMonitoring = function () {
  clearTimeout(this.timer);
  // This allows monitoring to be stopped from within the callback.
  this.uri = null;
};

/**
 * Request progress data from server.
 */
Drupal.progressBar.prototype.sendPing = function () {
  if (this.timer) {
    clearTimeout(this.timer);
  }
  if (this.uri) {
    var pb = this;
    // When doing a post request, you need non-null data. Otherwise a
    // HTTP 411 or HTTP 406 (with Apache mod_security) error may result.
    $.ajax({
      type: this.method,
      url: this.uri,
      data: '',
      dataType: 'json',
      success: function (progress) {
        // Display errors.
        if (progress.status == 0) {
          pb.displayError(progress.data);
          return;
        }
        // Update display.
        pb.setProgress(progress.percentage, progress.message);
        // Schedule next timer.
        pb.timer = setTimeout(function () { pb.sendPing(); }, pb.delay);
      },
      error: function (xmlhttp) {
        pb.displayError(Drupal.ajaxError(xmlhttp, pb.uri));
      }
    });
  }
};

/**
 * Display errors on the page.
 */
Drupal.progressBar.prototype.displayError = function (string) {
  var error = $('<div class="alert alert-block alert-error"><a class="close" data-dismiss="alert" href="#">&times;</a><h4>Error message</h4></div>').append(string);
  $(this.element).before(error).hide();

  if (this.errorCallback) {
    this.errorCallback(this);
  }
};

})(jQuery);
;
(function ($) {
  Drupal.homebox = {
    config: {}
  };
  Drupal.behaviors.homebox = {
    attach: function (context) {
      var $homebox = $('#homebox:not(.homebox-processed)', context).addClass('homebox-processed');

      if ($homebox.length > 0) {
        // Find all columns
        Drupal.homebox.$columns = $homebox.find('div.homebox-column');
        Drupal.homebox.$page = $homebox;

        // Try to find the button to save homebox state.
        Drupal.homebox.$pageSave = $homebox.find('#homebox-save-form [type=submit]');

        // Equilize columns height
        Drupal.homebox.equalizeColumnsHeights();

        // Make columns sortable
        Drupal.homebox.$columns.sortable({
          items: '.homebox-portlet.homebox-draggable',
          handle: '.portlet-header',
          connectWith: Drupal.homebox.$columns,
          placeholder: 'homebox-placeholder',
          forcePlaceholderSize: true,
          over: function () {
            Drupal.homebox.equalizeColumnsHeights();
          },
          stop: function () {
            Drupal.homebox.equalizeColumnsHeights();
            Drupal.homebox.pageChanged();
          }
        });

        $homebox.find('#homebox-add-link').click(function () {
          $(this).toggleClass('active');
          $homebox.find('#homebox-add').toggle();
        });

        // Populate hidden form element with block order and values.
        Drupal.homebox.$pageSave.mousedown(function () {
          var blocks = {}, regionIndex;
          Drupal.homebox.$columns.each(function () {
            // Determine region out of column-id.
            regionIndex = $(this).attr('id').replace(/homebox-column-/, '');
            $(this).find('.homebox-portlet').each(function (boxIndex) {
              var $this = $(this),
                color = 'default';

              // Determine custom color, if any
              $.each($this.attr('class').split(' '), function (key, a) {
                if (a.substr(0, 14) === 'homebox-color-') {
                  color = a.substr(14);
                }
              });

              // Build blocks object
              blocks[$this.attr('id').replace(/^homebox-block-/, '')] = $.param({
                region: regionIndex,
                status: $this.is(':visible') ? 1 : 0,
                color: color,
                open: $this.find('.portlet-content').is(':visible') ? 1 : 0
              });
            });
          });

          $(this).siblings('[name=blocks]').attr('value', $.param(blocks));
          $('#homebox-changes-made').hide();
        });

        // Equalize column heights after AJAX calls
        $homebox.ajaxStop(function () {
          Drupal.homebox.equalizeColumnsHeights();
        });
      }
    }
  };

  /**
   * Set all column heights equal
   */
  Drupal.homebox.equalizeColumnsHeights = function () {
    var maxHeight = {}, row;
    Drupal.homebox.$columns.each(function () {
      row = $(this).parent('.homebox-column-wrapper').attr('class').match(/homebox-row-(\d+)/i)[1];
      $(this).height('auto');
      maxHeight[row] = maxHeight[row] ? Math.max($(this).height(), maxHeight[row]) : $(this).height();
    }).each(function () {
      row = $(this).parent('.homebox-column-wrapper').attr('class').match(/homebox-row-(\d+)/i)[1];
      $(this).height(maxHeight[row]);
    });
  };

  Drupal.homebox.maximizeBox = function (icon) {
    // References to active portlet and its homebox
    var portlet = $(icon).parents('.homebox-portlet');
    var homebox = $(icon).parents('#homebox');

    // Only fire this action if this widget isnt being dragged
    if (!$(portlet).hasClass('ui-sortable-helper')) {
      // Check if we're maximizing or minimizing the portlet
      if ($(portlet).hasClass('portlet-maximized')) {
        // Minimizing portlet

        // Move this portlet to its original place (remembered with placeholder)
        $(portlet).insertBefore($(homebox).find('.homebox-maximized-placeholder'))
          .toggleClass('portlet-maximized');

        // Remove placeholder
        $(homebox).find('.homebox-maximized-placeholder').remove();

        // Show columns again
        $(homebox).find('.homebox-column').show();

        // Show close icon again
        $(portlet).find('.portlet-close').show();

        // Show the save button
        $('#homebox-save-form .form-submit').show();
        $('#homebox-minimize-to-save').hide();

        // Restore the checkbox under "Edit Content"
        $('input#homebox_toggle_' + $(portlet).attr('id')).removeAttr('disabled');
      }
      else {
        // Maximizing portlet

        // Add the portlet to maximized content place and create a placeholder
        // (for minimizing back to its place)
        $(portlet)
          .before('<div class="homebox-maximized-placeholder"></div>')
          .appendTo($(icon).parents('#homebox').find('.homebox-maximized'))
          .toggleClass('portlet-maximized');

        // Hide columns - only show maximized content place (including maximized widget)
        $(homebox).find('.homebox-column').hide();

        // Hide close icon (you wont be able to return if you close the widget)
        $(portlet).find('.portlet-close').hide();

        // Hide the save button
        $('#homebox-save-form .form-submit').hide();
        $('#homebox-minimize-to-save').show();

        // Disable the checkbox under "Edit content"
        $('input#homebox_toggle_' + $(portlet).attr('id')).attr('disabled', 'disabled');
      }
    }
  };

  Drupal.homebox.pageChanged = function () {
    if (Drupal.homebox.$page.hasClass('homebox-auto-save')) {
      Drupal.homebox.$pageSave.mousedown().click();
    }
    else {
      $('#homebox-changes-made').show();
    }
  };

  Drupal.homebox.hexColor = function (rgb) {
    // Handle hex strings like: #CCCCCC, #CCC, CCCCCC, CCC
    hexval = rgb.match(/^(#)?(\w{3})(\w{2})?$/);
    if (hexval) {
      return (!hexval[1] ? "#" + hexval[0] : hexval[0]);
    }

    rgb = rgb.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+))?\)$/);
    function hex(x) {
        return ("0" + parseInt(x).toString(16)).slice(-2);
    }
    return "#" + hex(rgb[1]) + hex(rgb[2]) + hex(rgb[3]);
  };

  Drupal.behaviors.homeboxPortlet = {
    attach: function (context) {
      $('.homebox-portlet:not(.homebox-processed)', context).addClass('homebox-processed').each(function () {
        var $portlet = $(this),
          $portletHeader = $portlet.find('.portlet-header'),
          $portletSettings = $portlet.find('.portlet-settings'),
          $portletConfig = $portlet.find('.portlet-config');

        // Restore classes saved before AHAH, they back some page-wide
        // settings.
        if (Drupal.homebox.config[$portlet.attr('id')] !== undefined) {
          $portlet.attr('class', Drupal.homebox.config[$portlet.attr('id')]);
        }

        // Prevent double-clicks from causing a selection
        $portletHeader.disableSelection();

        // Attach click event to maximize icon
        $portletHeader.find('.portlet-maximize').click(function () {
          $(this).toggleClass('portlet-maximize').toggleClass('portlet-minimize');
          Drupal.homebox.maximizeBox(this);
          Drupal.homebox.equalizeColumnsHeights();
        });

        // Attach click event on minus
        $portletHeader.find('.portlet-minus').click(function () {
          $(this).toggleClass('portlet-minus').toggleClass('portlet-plus');
          $portlet.find('.portlet-content').toggle();
          Drupal.homebox.equalizeColumnsHeights();
          Drupal.homebox.pageChanged();
        })
        .each(function () {
          if (!$portlet.find('.portlet-content').is(':visible')) {
            $(this).toggleClass('portlet-minus').toggleClass('portlet-plus');
            Drupal.homebox.equalizeColumnsHeights();
          }
        });

        // Attach double click event on portlet header
        $portlet.find('.portlet-title').dblclick(function () {
          if ($portlet.find('.portlet-content').is(':visible')) {
            $portletHeader.find('.portlet-minus').toggleClass('portlet-plus').toggleClass('portlet-minus');
          }
          else {
            $portletHeader.find('.portlet-plus').toggleClass('portlet-minus').toggleClass('portlet-plus');
          }
          $portlet.find('.portlet-content').toggle();

          Drupal.homebox.equalizeColumnsHeights();
          Drupal.homebox.pageChanged();
        });

        // Attach click event on settings icon
        $portletSettings.click(function () {
          $portletConfig.toggle();
          Drupal.homebox.equalizeColumnsHeights();
        });
        // Show settings if there are error messages
        if ($portletConfig.find('>.messages').length) {
          $portletSettings.trigger('click');
        }
        // Save classes on submit
        $portletConfig.find('.form-submit').click(function () {
          Drupal.homebox.config[$portlet.attr('id')] = $portlet.attr('class');
        });

        // Attach click event on close
        $portletHeader.find('.portlet-close').click(function () {
          $portlet.hide();
          Drupal.homebox.equalizeColumnsHeights();
          Drupal.homebox.pageChanged();
        });

        $.each($portlet.attr('class').split(' '), function (key, a) {
          if (a.substr(0, 14) === 'homebox-color-') {
            $portletHeader.attr('style', 'background: #' + a.substr(14));
            $portlet.find('.homebox-portlet-inner').attr('style', 'border: 1px solid #' + a.substr(14));
          }
        });

        // Add click behaviour to color buttons
        $portlet.find('.homebox-color-selector').click(function () {
          var color = $(this).css('background-color');
          color = Drupal.homebox.hexColor(color);

          $.each($portlet.attr('class').split(' '), function (key, value) {
            if (value.indexOf('homebox-color-') === 0) {
              $portlet.removeClass(value);
            }
          });

          // Add color classes to blocks
          // This is used when we save so we know what color it is
          $portlet.addClass('homebox-color-' + color.replace('#', ''));

          // Apply the colors via style attributes
          // This avoid dynamic CSS
          $portletHeader.attr('style', 'background: ' + color);
          $portlet.find('.homebox-portlet-inner').attr('style', 'border: 1px solid ' + color);
          Drupal.homebox.pageChanged();
        });
      });
    }
  };
})(jQuery);
;
(function ($) {

$(document).ready(function() {

  // Attach mousedown, keyup, touchstart events to document only and catch
  // clicks on all elements.
  $(document.body).bind("mousedown keyup touchstart", function(event) {

    // Catch the closest surrounding link of a clicked element.
    $(event.target).closest("a,area").each(function() {

      if (Drupal.settings.piwik.trackMailto && $(this).is("a[href^='mailto:'],area[href^='mailto:']")) {
        // Mailto link clicked.
        _paq.push(["trackEvent", "Mails", "Click", this.href.substring(7)]);
      }

    });
  });

  // Colorbox: This event triggers when the transition has completed and the
  // newly loaded content has been revealed.
  $(document).bind("cbox_complete", function () {
    var href = $.colorbox.element().attr("href");
    if (href) {
      _paq.push(["setCustomUrl", href]);
      _paq.push(["trackPageView"]);
    }
  });

});

})(jQuery);
;
